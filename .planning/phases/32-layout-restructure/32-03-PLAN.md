---
phase: 32-layout-restructure
plan: 03
type: execute
wave: 2
depends_on: ["32-01", "32-02"]
files_modified:
  - src/App.tsx
  - src/layout/MainLayout/index.tsx
autonomous: true

must_haves:
  truths:
    - "User sees tab navigation displaying 5 tabs"
    - "User sees right sidebar always visible with fixed width"
    - "User sees run title and action buttons in top bar"
    - "Virtual scrolling works with 500+ tests"
  artifacts:
    - path: "src/App.tsx"
      provides: "CSS Grid layout with header + main + sidebar"
      contains: "grid-rows-\\[auto_1fr\\]"
    - path: "src/layout/MainLayout/index.tsx"
      provides: "Tab navigation integration and view rendering"
      contains: "TabNavigation"
  key_links:
    - from: "src/App.tsx"
      to: "RunInfoSidebar"
      via: "CSS Grid sidebar column"
      pattern: "grid-cols-.*300px"
    - from: "src/layout/MainLayout/index.tsx"
      to: "TabNavigation"
      via: "component import and render"
      pattern: "import.*TabNavigation"
---

<objective>
Integrate TabNavigation and RunInfoSidebar into App.tsx with CSS Grid layout.

Purpose: Complete the layout restructure with tabs, right sidebar, and updated top bar.
Output: Working layout with all Phase 32 success criteria met.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-layout-restructure/32-RESEARCH.md

@.planning/phases/32-layout-restructure/32-01-SUMMARY.md
@.planning/phases/32-layout-restructure/32-02-SUMMARY.md

@src/App.tsx
@src/layout/MainLayout/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update App.tsx with CSS Grid layout</name>
  <files>src/App.tsx</files>
  <action>
Refactor App.tsx to use CSS Grid layout:

1. REMOVE hamburger menu completely:
   - Delete anchorEl state and related handlers
   - Delete menuItems array
   - Delete hamburger button from header
   - Delete navigation menu dropdown JSX

2. UPDATE header (top bar):
   - Keep fixed header with border-b bg-card
   - Show run title: `{reportStore.runData?.title || 'Qase | Report'}`
   - Truncate long titles: `truncate max-w-md`
   - Keep action buttons (search, export, theme toggle)
   - REMOVE StatusBarPill from header (moved to sidebar)
   - REMOVE flex-grow div around StatusBarPill

3. CHANGE layout structure to CSS Grid:
   ```
   <div className="min-h-screen grid grid-rows-[auto_1fr] bg-background">
     <header>...</header>
     <div className="grid grid-cols-1 lg:grid-cols-[1fr_300px] overflow-hidden">
       <main className="overflow-y-auto">
         <MainLayout />
       </main>
       <aside className="hidden lg:block border-l bg-card overflow-y-auto">
         <div className="p-4">
           <RunInfoSidebar />
         </div>
       </aside>
     </div>
   </div>
   ```

4. REMOVE h-12 spacer div (no longer needed with grid layout)

5. ADD import for RunInfoSidebar, useRootStore (for reportStore access)

6. KEEP imports: ThemeProvider, ThemeToggle, SearchModal, ExportButton, MainLayout
7. KEEP hotkey for Cmd+K search
8. KEEP SearchModal at bottom

Reference research pattern from 32-RESEARCH.md "Pattern 1: CSS Grid Layout with Fixed Sidebar".
  </action>
  <verify>
```bash
grep -E "grid-rows|grid-cols|RunInfoSidebar" src/App.tsx
```
Should show grid-rows-[auto_1fr], grid-cols-[1fr_300px], RunInfoSidebar import/usage.
  </verify>
  <done>App.tsx uses CSS Grid layout with fixed 300px right sidebar, hamburger menu removed</done>
</task>

<task type="auto">
  <name>Task 2: Update MainLayout with TabNavigation</name>
  <files>src/layout/MainLayout/index.tsx</files>
  <action>
Refactor MainLayout to integrate TabNavigation:

1. ADD import for TabNavigation component

2. RESTRUCTURE layout:
   ```tsx
   <div className="flex flex-col h-full">
     <TabNavigation />
     <div className="flex-1 overflow-y-auto p-4">
       <div className="flex gap-4 mb-4">
         <LoadReportButton />
       </div>
       {renderView()}
     </div>
   </div>
   ```

3. UPDATE renderView() to handle tab views WITHOUT dashboard+tests combo:
   - 'tests' -> TestList or empty state
   - 'dashboard' -> Dashboard only (no TestList below)
   - 'failure-clusters' -> FailureClusters
   - 'gallery' -> Gallery
   - 'comparison' -> Comparison
   - Remove 'analytics' case (not in tab navigation)

4. REMOVE h-[calc(100vh-48px)] from main (parent controls height now)

5. KEEP TestDetailsModal and AttachmentViewer renders
6. KEEP observer() wrapper

Note: Do NOT use TabsContent components - render views with switch/if to preserve react-window virtual scrolling.
  </action>
  <verify>
```bash
grep -E "TabNavigation|flex-col h-full" src/layout/MainLayout/index.tsx
```
Should show TabNavigation import and flex-col h-full layout.
  </verify>
  <done>MainLayout renders TabNavigation at top with view content below</done>
</task>

<task type="auto">
  <name>Task 3: Remove StatusBarPill from App.tsx imports</name>
  <files>src/App.tsx</files>
  <action>
Clean up unused imports from App.tsx:

1. REMOVE import for StatusBarPill (moved to sidebar, not used in header)
2. REMOVE unused icon imports that were only for hamburger menu:
   - MenuIcon (no longer needed)
   - Activity/BubbleChart (analytics removed from navigation)

3. KEEP icon imports used elsewhere:
   - SearchIcon (search button)
   - Any icons that TabNavigation might need (check TabNavigation imports)

4. REMOVE observer wrapper if App no longer needs MobX reactivity directly
   - Check if App uses any observable values
   - reportStore.runData?.title needs observer OR use hook inside header

5. If keeping MobX reactivity: wrap App in observer()
   If not needed: keep as plain function component

Note: After this task, verify no unused imports remain with `npm run build`.
  </action>
  <verify>
```bash
grep -E "StatusBarPill|MenuIcon|BubbleChart" src/App.tsx || echo "Removed successfully"
```
Should print "Removed successfully" (no matches found).
  </verify>
  <done>Unused imports removed from App.tsx, build passes without warnings</done>
</task>

</tasks>

<verification>
1. `npm run build` - TypeScript compilation passes, no unused import warnings
2. `npm run dev` - App loads with:
   - Tab navigation visible with 5 tabs
   - Right sidebar visible on desktop (hidden on mobile)
   - Run title in top bar
   - Action buttons (search, export, theme) in top bar
3. Click tabs - views switch correctly
4. Load report - sidebar shows pass rate ring and metadata
5. Virtual scrolling works in TestList (scroll 500+ tests without lag)
</verification>

<success_criteria>
- CSS Grid layout with header + main + sidebar
- Tab navigation displays 5 tabs
- Right sidebar always visible (desktop) with pass rate ring
- Run title shows in top bar
- Hamburger menu completely removed
- Virtual scrolling preserved
- No TypeScript errors or unused imports
</success_criteria>

<output>
After completion, create `.planning/phases/32-layout-restructure/32-03-SUMMARY.md`
</output>
