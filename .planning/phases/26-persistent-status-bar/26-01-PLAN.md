---
phase: 26-persistent-status-bar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/StatusBarPill/index.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User sees compact pass rate donut in top bar"
    - "User sees run date and duration in top bar"
    - "User sees passed/failed/skipped counts in top bar"
    - "Status information visible in all views without scrolling"
  artifacts:
    - path: "src/components/StatusBarPill/index.tsx"
      provides: "Compact status visualization component"
      exports: ["StatusBarPill"]
      min_lines: 60
    - path: "src/App.tsx"
      provides: "StatusBarPill integration in AppBar"
      contains: "StatusBarPill"
  key_links:
    - from: "src/components/StatusBarPill/index.tsx"
      to: "reportStore.runData"
      via: "useRootStore hook"
      pattern: "reportStore\\.runData"
    - from: "src/components/StatusBarPill/index.tsx"
      to: "analyticsStore.flakyTestCount"
      via: "useRootStore hook"
      pattern: "analyticsStore\\.flakyTestCount"
    - from: "src/App.tsx"
      to: "src/components/StatusBarPill/index.tsx"
      via: "import and render"
      pattern: "import.*StatusBarPill"
---

<objective>
Add persistent status bar to AppBar showing run statistics at all times.

Purpose: Users need to see pass rate and run status regardless of scroll position or active view. Currently status is only visible in sidebar which may be collapsed or scrolled out of view.

Output: StatusBarPill component in AppBar center section replacing RunDateDisplay, with compact pass rate ring, quick stats, and run metadata.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-persistent-status-bar/26-RESEARCH.md

@src/App.tsx
@src/components/RunDateDisplay/index.tsx
@src/components/Dashboard/ProgressRingCard.tsx
@src/store/ReportStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatusBarPill component</name>
  <files>src/components/StatusBarPill/index.tsx</files>
  <action>
Create StatusBarPill component that displays compact status in AppBar toolbar:

1. **Component structure:**
   - Wrap with `observer()` from mobx-react-lite for MobX reactivity
   - Use `useRootStore()` to access reportStore and analyticsStore
   - Guard with `if (!reportStore.runData) return null` at top

2. **Compact pass rate ring (40px):**
   - Use two-CircularProgress overlay pattern from ProgressRingCard
   - Size: 40px, thickness: 4
   - Background ring: `color: 'action.hover'`, value: 100
   - Foreground ring: `color: getColor(passRate)`, value: passRate
   - Color logic: >=80 success.main, >=50 warning.main, else error.main
   - Center: percentage text with `variant="caption"` and `fontSize="0.7rem"`

3. **Quick stats section:**
   - Horizontal row with passed/failed counts
   - Use colored Typography: success.main for passed, error.main for failed
   - Show skipped count only if > 0 (text.secondary color)
   - Show flaky count (from analyticsStore.flakyTestCount) only if > 0 (warning.main with ~ suffix)
   - Hide on mobile with `sx={{ display: { xs: 'none', sm: 'flex' } }}`

4. **Run metadata:**
   - Format date using `Intl.DateTimeFormat` with dateStyle: 'medium', timeStyle: 'short'
   - Include duration from `reportStore.formattedDuration`
   - Format: "{date} - {duration}"
   - Hide on small screens with `sx={{ display: { xs: 'none', md: 'block' } }}`

5. **Layout:**
   - Outer Box with `display: 'flex', alignItems: 'center', gap: 2`
   - Ring first, then stats, then metadata
  </action>
  <verify>
    - File exists at src/components/StatusBarPill/index.tsx
    - Component exports named StatusBarPill
    - Contains observer() wrapper
    - Contains null guard for runData
    - Contains CircularProgress components (2x)
    - Contains responsive display breakpoints (xs, sm, md)
  </verify>
  <done>
StatusBarPill component renders compact pass rate ring, quick stats (passed/failed/skipped/flaky counts), and run metadata with responsive breakpoints.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate StatusBarPill into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Modify App.tsx to replace RunDateDisplay with StatusBarPill:

1. **Update imports:**
   - Add: `import { StatusBarPill } from './components/StatusBarPill'`
   - Remove: `import { RunDateDisplay } from './components/RunDateDisplay'` (no longer needed)

2. **Replace in Toolbar center section:**
   - Find the center Box with `flexGrow: 1` and `justifyContent: 'center'`
   - Replace `<RunDateDisplay />` with `<StatusBarPill />`

3. **No other changes needed:**
   - Hamburger menu, title, actions section remain unchanged
   - StatusBarPill handles its own null state when no report loaded
  </action>
  <verify>
    - App.tsx imports StatusBarPill
    - App.tsx no longer imports RunDateDisplay
    - StatusBarPill rendered in center section of Toolbar
    - `npm run build` succeeds with no errors
  </verify>
  <done>
StatusBarPill replaces RunDateDisplay in AppBar. Status information visible in all views without scrolling.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Visual verification:**
   - Load a report and verify AppBar shows pass rate ring
   - Verify quick stats show correct passed/failed counts
   - Verify run date and duration display

2. **Responsive behavior:**
   - At mobile width (<600px): only ring visible
   - At tablet width (600-900px): ring + stats visible
   - At desktop width (>900px): ring + stats + metadata visible

3. **Build verification:**
   ```bash
   npm run build
   ```
   No TypeScript errors, successful production build.
</verification>

<success_criteria>
- [ ] STAT-01: Compact pass rate donut visible in top bar
- [ ] STAT-02: Run info (date, duration) visible in top bar
- [ ] STAT-03: Quick stats (passed/failed/skipped) visible in top bar
- [ ] Status visible in all views without scrolling
- [ ] Responsive: appropriate content hidden on smaller screens
- [ ] Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/26-persistent-status-bar/26-01-SUMMARY.md`
</output>
