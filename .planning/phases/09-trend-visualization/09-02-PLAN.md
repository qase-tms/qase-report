---
phase: 09-trend-visualization
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - package.json
  - src/components/Dashboard/TrendsChart.tsx
  - src/components/Dashboard/index.tsx
autonomous: true

must_haves:
  truths:
    - "User can see pass rate trend chart with passed/failed/skipped over time"
    - "User can see duration trend chart showing test execution time changes"
    - "Charts display tooltips with detailed information on hover"
    - "Charts gracefully handle missing data points and outliers"
  artifacts:
    - path: "src/components/Dashboard/TrendsChart.tsx"
      provides: "Recharts line charts for pass rate and duration trends"
      exports: ["TrendsChart"]
      min_lines: 100
    - path: "src/components/Dashboard/index.tsx"
      provides: "Dashboard with conditional trend chart rendering"
      contains: "TrendsChart"
  key_links:
    - from: "src/components/Dashboard/TrendsChart.tsx"
      to: "src/store/AnalyticsStore.ts"
      via: "useRootStore().analyticsStore access"
      pattern: "analyticsStore\\.passRateTrend"
    - from: "src/components/Dashboard/index.tsx"
      to: "src/components/Dashboard/TrendsChart.tsx"
      via: "import and conditional render"
      pattern: "hasTrendData.*TrendsChart"
---

<objective>
Create TrendsChart component using Recharts and integrate into Dashboard with conditional rendering.

Purpose: Visualize historical pass rate and duration trends when history data is available. Charts only render when 2+ runs exist (hasTrendData).

Output: TrendsChart component with pass rate and duration line charts, integrated into Dashboard grid.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-trend-visualization/09-01-SUMMARY.md
@src/store/AnalyticsStore.ts
@src/components/Dashboard/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install recharts dependency</name>
  <files>package.json</files>
  <action>
Install recharts for charting:

```bash
cd /Users/gda/Documents/github/qase-tms/qase-report && npm install recharts@^2.15.0
```

Use recharts v2.x (not v3.x) for stability. Version 2.15.0+ has good React 18 support.

Note: date-fns is NOT needed for this phase. We use native Date.toLocaleDateString() for chart labels as implemented in AnalyticsStore.
  </action>
  <verify>
Run: `grep "recharts" package.json`
Check: recharts is in dependencies
  </verify>
  <done>
recharts added to package.json dependencies
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TrendsChart component with pass rate and duration charts</name>
  <files>src/components/Dashboard/TrendsChart.tsx</files>
  <action>
Create Recharts-based trend visualization component:

1. **Imports:**
   ```typescript
   import { observer } from 'mobx-react-lite'
   import { Box, Card, CardContent, Typography, useTheme } from '@mui/material'
   import {
     LineChart,
     Line,
     XAxis,
     YAxis,
     CartesianGrid,
     Tooltip,
     Legend,
     ResponsiveContainer,
   } from 'recharts'
   import { useRootStore } from '../../store'
   ```

2. **TrendsChart component (observer-wrapped):**
   - Get analyticsStore from useRootStore()
   - Get MUI theme for colors via useTheme()
   - Return null if !analyticsStore.hasTrendData

3. **Pass Rate Chart:**
   - Card with title "Pass Rate Trend"
   - ResponsiveContainer with height={300}
   - LineChart with data={analyticsStore.passRateTrend}
   - XAxis dataKey="date"
   - YAxis domain={[0, 100]} with unit="%"
   - Lines for: passed (green), failed (red), skipped (yellow)
   - Use theme.palette.success.main, error.main, warning.main for colors
   - CartesianGrid with strokeDasharray="3 3"
   - Tooltip with custom formatter showing percentage values
   - Legend at bottom

4. **Duration Chart:**
   - Card with title "Duration Trend"
   - ResponsiveContainer with height={250}
   - LineChart with data={analyticsStore.durationTrend}
   - XAxis dataKey="date"
   - YAxis with formatter to show duration in seconds (duration/1000)
   - Single Line for duration (primary color)
   - Tooltip with custom formatter: `${(value/1000).toFixed(1)}s`

5. **Custom Tooltip component:**
   ```typescript
   const CustomTooltip = ({ active, payload, label }: any) => {
     if (!active || !payload?.length) return null
     const data = payload[0].payload
     return (
       <Card sx={{ p: 1 }}>
         <Typography variant="body2" fontWeight="bold">{label}</Typography>
         <Typography variant="body2">Total: {data.total}</Typography>
         <Typography variant="body2" color="success.main">
           Passed: {data.passed} ({data.passRate.toFixed(1)}%)
         </Typography>
         <Typography variant="body2" color="error.main">
           Failed: {data.failed}
         </Typography>
         <Typography variant="body2">
           Duration: {(data.duration / 1000).toFixed(1)}s
         </Typography>
       </Card>
     )
   }
   ```

6. **Layout:**
   - Stack the two charts vertically
   - Use Box with mb={3} between cards
   - Charts fill available width via ResponsiveContainer

7. **Export TrendsChart as named export**

Handle edge cases:
- Empty trend data: return null (hasTrendData check)
- Zero duration: show 0s
- All tests passed: 100% pass rate line at top
  </action>
  <verify>
Run: `cd /Users/gda/Documents/github/qase-tms/qase-report && npx tsc --noEmit`
Check: No TypeScript errors
Check: File exists with export: `grep "export.*TrendsChart" src/components/Dashboard/TrendsChart.tsx`
  </verify>
  <done>
TrendsChart.tsx exists with:
- Pass rate line chart (passed/failed/skipped over time)
- Duration line chart (execution time over time)
- Custom tooltips with detailed information
- MUI theme integration for colors
- Responsive container for chart sizing
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate TrendsChart into Dashboard</name>
  <files>src/components/Dashboard/index.tsx</files>
  <action>
Update Dashboard to show TrendsChart when history data available:

1. **Add import:**
   ```typescript
   import { TrendsChart } from './TrendsChart'
   ```

2. **Get analyticsStore from useRootStore:**
   ```typescript
   const { reportStore, analyticsStore } = useRootStore()
   ```

3. **Add TrendsChart after existing Grid content:**
   After the closing Grid container (stats + metadata cards), add:
   ```tsx
   {analyticsStore.hasTrendData && (
     <Box sx={{ mt: 3 }}>
       <TrendsChart />
     </Box>
   )}
   ```

4. **Wrap entire return in Fragment if needed:**
   Current return is a single Grid. Wrap in Fragment to add TrendsChart:
   ```tsx
   return (
     <>
       <Grid container spacing={3}>
         {/* existing content */}
       </Grid>
       {analyticsStore.hasTrendData && (
         <Box sx={{ mt: 3 }}>
           <TrendsChart />
         </Box>
       )}
     </>
   )
   ```

Conditional rendering ensures:
- TrendsChart only shows when 2+ historical runs exist
- No empty chart state - either full chart or nothing
- Dashboard still works without history data
  </action>
  <verify>
Run: `cd /Users/gda/Documents/github/qase-tms/qase-report && npx tsc --noEmit`
Check: TrendsChart imported: `grep "import.*TrendsChart" src/components/Dashboard/index.tsx`
Check: Conditional render: `grep "hasTrendData" src/components/Dashboard/index.tsx`
  </verify>
  <done>
Dashboard conditionally renders TrendsChart when history data available. TypeScript compilation passes.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npm run build` succeeds
2. Recharts dependency: Listed in package.json dependencies
3. TrendsChart renders: Pass rate and duration charts visible with mock data
4. Conditional rendering: TrendsChart hidden when hasTrendData is false
5. Tooltips work: Hover shows detailed information
6. Responsive: Charts resize with container
</verification>

<success_criteria>
- [ ] recharts added to package.json
- [ ] TrendsChart.tsx exists with 100+ lines
- [ ] Pass rate chart shows passed/failed/skipped lines
- [ ] Duration chart shows execution time trend
- [ ] Custom tooltips show detailed run information
- [ ] Dashboard conditionally renders TrendsChart
- [ ] Charts use MUI theme colors
- [ ] All TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-trend-visualization/09-02-SUMMARY.md`
</output>
