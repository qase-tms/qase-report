---
phase: 03-test-list-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/store/TestResultsStore.ts
  - src/store/index.tsx
autonomous: true

must_haves:
  truths:
    - "TestResultsStore has computed filteredResults that reacts to statusFilters and searchQuery"
    - "Filtering by status returns only tests with matching execution.status"
    - "Searching by query returns only tests with title containing query (case-insensitive)"
    - "RootStore tracks selectedTestId and provides selectTest/clearSelection actions"
  artifacts:
    - path: "src/store/TestResultsStore.ts"
      provides: "filteredResults computed, statusFilters Set, searchQuery observable, filter actions"
      contains: "get filteredResults"
    - path: "src/store/index.tsx"
      provides: "selectedTestId observable, selectTest action, selectedTest computed"
      contains: "selectedTestId"
  key_links:
    - from: "TestResultsStore.filteredResults"
      to: "statusFilters + searchQuery"
      via: "computed getter reads observables"
      pattern: "this\\.statusFilters|this\\.searchQuery"
    - from: "RootStore.selectedTest"
      to: "testResultsStore.testResults"
      via: "computed getter looks up by selectedTestId"
      pattern: "testResultsStore\\.testResults\\.get"
---

<objective>
Extend MobX stores with filtering, search, and navigation state management.

Purpose: Provides reactive state foundation for test list filtering by status, searching by name, and tracking which test is selected for navigation to details view.

Output: Extended TestResultsStore with filteredResults computed, extended RootStore with selectedTestId state.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-test-list-navigation/03-RESEARCH.md

@src/store/index.tsx
@src/store/TestResultsStore.ts
@src/schemas/QaseTestResult.schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @mui/icons-material</name>
  <files>package.json, package-lock.json</files>
  <action>
Install @mui/icons-material for status icons (CheckCircle, Error, Warning, DoNotDisturb).

Run:
```bash
npm install @mui/icons-material
```

This is the standard MUI icon library. It provides tree-shakeable Material Design icons.
  </action>
  <verify>
`npm ls @mui/icons-material` shows installed version.
`grep "@mui/icons-material" package.json` shows dependency.
  </verify>
  <done>@mui/icons-material is installed and available for import.</done>
</task>

<task type="auto">
  <name>Task 2: Extend TestResultsStore with filtering and search</name>
  <files>src/store/TestResultsStore.ts</files>
  <action>
Add filtering and search capabilities to TestResultsStore:

1. Add observable state:
   - `searchQuery = ''` - string for search input
   - `statusFilters = new Set<string>()` - Set for active status filters ('passed', 'failed', 'skipped', 'broken')

2. Add computed getter `filteredResults`:
   - Start with `this.resultsList`
   - If `statusFilters.size > 0`, filter to only include tests where `execution.status` is in the Set
   - If `searchQuery.trim()` is non-empty, filter to only include tests where `title.toLowerCase()` includes `searchQuery.toLowerCase()`
   - Return the filtered array

3. Add action methods:
   - `setSearchQuery = (query: string) => { this.searchQuery = query }`
   - `toggleStatusFilter = (status: string) => { if (this.statusFilters.has(status)) this.statusFilters.delete(status); else this.statusFilters.add(status) }`
   - `clearFilters = () => { this.searchQuery = ''; this.statusFilters.clear() }`

4. Add computed getter for filter summary:
   - `get activeFilterCount(): number` - returns `statusFilters.size + (searchQuery.trim() ? 1 : 0)`

Use `makeAutoObservable(this)` which is already in constructor - new observables and computed getters will be automatically detected.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`

Manual verification in console:
1. Load report
2. `store.testResultsStore.filteredResults.length` equals total tests
3. `store.testResultsStore.toggleStatusFilter('passed')`
4. `store.testResultsStore.filteredResults.length` shows only passed tests
5. `store.testResultsStore.setSearchQuery('login')`
6. `store.testResultsStore.filteredResults` shows only passed tests with 'login' in title
  </verify>
  <done>
TestResultsStore has searchQuery observable, statusFilters Set, filteredResults computed getter, and action methods (setSearchQuery, toggleStatusFilter, clearFilters).
  </done>
</task>

<task type="auto">
  <name>Task 3: Extend RootStore with navigation state</name>
  <files>src/store/index.tsx</files>
  <action>
Add test selection/navigation state to RootStore:

1. Add observable:
   - `selectedTestId: string | null = null`

2. Add action methods:
   - `selectTest = (testId: string) => { this.selectedTestId = testId }`
   - `clearSelection = () => { this.selectedTestId = null }`

3. Add computed getter:
   - `get selectedTest(): QaseTestResult | null` - if `selectedTestId` is null, return null; otherwise return `this.testResultsStore.testResults.get(this.selectedTestId) || null`

4. Import QaseTestResult type at top of file:
   `import type { QaseTestResult } from '../schemas/QaseTestResult.schema'`

`makeAutoObservable(this)` is already in constructor, so new observables will be auto-detected.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`

Manual verification in console after loading report:
1. `store.selectedTestId` is null
2. Get a test ID: `const id = store.testResultsStore.resultsList[0].id`
3. `store.selectTest(id)`
4. `store.selectedTestId` equals the ID
5. `store.selectedTest?.title` shows the test title
6. `store.clearSelection()`
7. `store.selectedTestId` is null again
  </verify>
  <done>
RootStore has selectedTestId observable, selectTest/clearSelection actions, and selectedTest computed getter.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. `npm ls @mui/icons-material` shows package installed
2. `npx tsc --noEmit` passes without errors
3. All new store properties are accessible and reactive
4. Filtering works: toggle status filter reduces filteredResults
5. Search works: set query reduces filteredResults
6. Navigation state works: selectTest sets selectedTestId, selectedTest returns the test object
</verification>

<success_criteria>
1. @mui/icons-material installed in package.json
2. TestResultsStore has filteredResults computed that combines statusFilters and searchQuery
3. TestResultsStore has setSearchQuery, toggleStatusFilter, clearFilters actions
4. RootStore has selectedTestId observable with selectTest/clearSelection actions
5. RootStore has selectedTest computed that returns QaseTestResult or null
6. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-test-list-navigation/03-01-SUMMARY.md`
</output>
