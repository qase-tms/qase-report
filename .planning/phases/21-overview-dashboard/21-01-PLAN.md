---
phase: 21-overview-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/ReportStore.ts
  - src/components/Dashboard/SuiteHealthCard.tsx
  - src/components/Dashboard/AttentionRequiredCard.tsx
  - src/components/Dashboard/QuickInsightsCard.tsx
  - src/components/Dashboard/index.tsx
autonomous: true

must_haves:
  truths:
    - "Suite Health section shows pass rates by suite"
    - "Pass Rate card shows current value with sparkline trend"
    - "Duration card shows current value with sparkline trend"
    - "Attention Required section lists failed and flaky tests"
    - "Quick Insights shows top failures and slowest tests"
  artifacts:
    - path: "src/store/ReportStore.ts"
      provides: "Suite pass rates computed property"
      contains: "get suitePassRates"
    - path: "src/components/Dashboard/SuiteHealthCard.tsx"
      provides: "Suite health visualization with LinearProgress bars"
      min_lines: 40
    - path: "src/components/Dashboard/AttentionRequiredCard.tsx"
      provides: "Clickable list of failed and flaky tests"
      min_lines: 50
    - path: "src/components/Dashboard/QuickInsightsCard.tsx"
      provides: "Top failures and slowest tests sections"
      min_lines: 60
    - path: "src/components/Dashboard/index.tsx"
      provides: "Dashboard composition with new cards"
      contains: "SuiteHealthCard"
  key_links:
    - from: "src/components/Dashboard/SuiteHealthCard.tsx"
      to: "src/store/ReportStore.ts"
      via: "useRootStore().reportStore.suitePassRates"
      pattern: "reportStore\\.suitePassRates"
    - from: "src/components/Dashboard/AttentionRequiredCard.tsx"
      to: "src/store/TestResultsStore.ts"
      via: "useRootStore() for failed tests"
      pattern: "testResultsStore\\.resultsList"
    - from: "src/components/Dashboard/QuickInsightsCard.tsx"
      to: "src/store/TestResultsStore.ts"
      via: "useRootStore() for slowest tests"
      pattern: "testResultsStore\\.resultsList"
    - from: "src/components/Dashboard/index.tsx"
      to: "new card components"
      via: "import and render in BentoGrid"
      pattern: "import.*SuiteHealthCard"
---

<objective>
Add comprehensive overview sections to the Dashboard for test health monitoring.

Purpose: Users need a complete overview of test suite health at a glance - which suites are struggling, which tests need attention, and quick insights into failures and performance.

Output:
- ReportStore with suitePassRates computed property
- SuiteHealthCard component showing suite pass rates with progress bars
- AttentionRequiredCard component showing failed and flaky tests
- QuickInsightsCard component showing top failures and slowest tests
- Updated Dashboard integrating all new cards
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-overview-dashboard/21-RESEARCH.md

# Key existing files
@src/store/ReportStore.ts
@src/store/TestResultsStore.ts
@src/store/AnalyticsStore.ts
@src/components/Dashboard/index.tsx
@src/components/Dashboard/TestHealthWidget.tsx
@src/components/Dashboard/AlertsPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add computed properties to ReportStore</name>
  <files>src/store/ReportStore.ts</files>
  <action>
Add computed property `suitePassRates` to ReportStore that groups tests by suite and computes pass rate per suite.

Implementation:
```typescript
/**
 * Returns pass rates per suite, computed from test results.
 * Groups tests by suite relation, calculates passed/total ratio.
 */
get suitePassRates(): Array<{ suite: string; passRate: number; total: number; passed: number }> {
  if (!this.runData) return []

  const suiteGroups = new Map<string, { passed: number; total: number }>()

  for (const test of this.root.testResultsStore.resultsList) {
    const suites = test.relations?.suite?.data || []

    for (const suite of suites) {
      const existing = suiteGroups.get(suite.title) || { passed: 0, total: 0 }
      existing.total++
      if (test.execution.status === 'passed') existing.passed++
      suiteGroups.set(suite.title, existing)
    }
  }

  return Array.from(suiteGroups.entries())
    .map(([suite, stats]) => ({
      suite,
      passRate: stats.total > 0 ? (stats.passed / stats.total) * 100 : 0,
      total: stats.total,
      passed: stats.passed,
    }))
    .sort((a, b) => a.passRate - b.passRate) // Worst first for attention
}
```
  </action>
  <verify>Run `npm run build` to confirm TypeScript compilation succeeds with no errors.</verify>
  <done>ReportStore has suitePassRates computed property returning array of {suite, passRate, total, passed} sorted by passRate ascending (worst suites first).</done>
</task>

<task type="auto">
  <name>Task 2: Create SuiteHealthCard, AttentionRequiredCard, and QuickInsightsCard components</name>
  <files>
    src/components/Dashboard/SuiteHealthCard.tsx
    src/components/Dashboard/AttentionRequiredCard.tsx
    src/components/Dashboard/QuickInsightsCard.tsx
  </files>
  <action>
Create three new Dashboard card components following existing patterns from TestHealthWidget and AlertsPanel.

**SuiteHealthCard.tsx:**
- Observer component using useRootStore()
- Display suite pass rates with LinearProgress bars (pattern from TestHealthWidget)
- Color code: green for 90%+, warning for 70-89%, error for below 70%
- Show suite name, progress bar, and "X/Y (Z%)" count
- Limit to top 5 worst-performing suites (sorted by passRate ascending)
- Handle empty state: "No suite data available"

**AttentionRequiredCard.tsx:**
- Observer component using useRootStore()
- Combine failed tests from current run + tests that are historically flaky
- Use testResultsStore.resultsList filtered by status === 'failed'
- Cross-reference with analyticsStore.flakyTests for flaky badge
- Clickable list items (use ListItemButton pattern from AlertsPanel)
- Props: `onTestClick: (testId: string) => void`
- Show Chip badges: "Failed" (error color) and/or "Flaky" (warning color)
- Limit to 5 items, show "+N more" if needed
- Handle empty state: "No tests require attention"

**QuickInsightsCard.tsx:**
- Observer component using useRootStore()
- Two sections in one card:
  1. **Top Failures**: Failed tests, sorted by historical failure count (from historyStore.getTestHistory)
  2. **Slowest Tests**: Passed/failed tests sorted by duration descending
- Each section shows top 3 tests
- Use Stack with Typography divider between sections
- Props: `onTestClick: (testId: string) => void`
- Handle empty states per section

Use existing patterns:
- Box, Paper, Typography, Chip, LinearProgress, Stack from MUI
- List, ListItem, ListItemButton, ListItemText for clickable items
- observer() wrapper from mobx-react-lite
  </action>
  <verify>Run `npm run build` to confirm all three components compile with no TypeScript errors.</verify>
  <done>Three new components exist: SuiteHealthCard shows suite pass rates with progress bars, AttentionRequiredCard shows failed/flaky tests with clickable navigation, QuickInsightsCard shows top failures and slowest tests in two sections.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate new cards into Dashboard</name>
  <files>src/components/Dashboard/index.tsx</files>
  <action>
Update Dashboard component to include new cards in the BentoGrid layout.

1. Add imports for new components:
```typescript
import { SuiteHealthCard } from './SuiteHealthCard'
import { AttentionRequiredCard } from './AttentionRequiredCard'
import { QuickInsightsCard } from './QuickInsightsCard'
```

2. Add handleTestClick function (similar to handleAlertClick but uses test id directly):
```typescript
const handleTestClick = (testId: string) => {
  reportStore.root.selectTest(testId)
}
```

3. Add conditional rendering for new cards in BentoGrid after existing cards:

```typescript
{/* Suite Health - 2x2 for proper list display */}
{reportStore.suitePassRates.length > 0 && (
  <DashboardCard colSpan={2} rowSpan={2}>
    <SuiteHealthCard />
  </DashboardCard>
)}

{/* Attention Required - 3x1 wide list */}
<DashboardCard colSpan={3}>
  <AttentionRequiredCard onTestClick={handleTestClick} />
</DashboardCard>

{/* Quick Insights - 2x2 for two sections */}
<DashboardCard colSpan={2} rowSpan={2}>
  <QuickInsightsCard onTestClick={handleTestClick} />
</DashboardCard>
```

Note: AttentionRequiredCard and QuickInsightsCard always render (they handle their own empty states internally). SuiteHealthCard conditionally renders based on data availability.

Position these cards after the RunInfo and HostInfo cards but before the TrendsChart for logical flow.
  </action>
  <verify>Run `npm run dev` and load a report to visually confirm all new cards render in the Dashboard. Cards should display data when available and show empty states otherwise.</verify>
  <done>Dashboard displays SuiteHealthCard (when suite data available), AttentionRequiredCard (always, with internal empty state), and QuickInsightsCard (always, with internal empty state). Clicking tests in AttentionRequired and QuickInsights navigates to test details.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no errors
2. Load a Qase report JSON in the app
3. Dashboard shows new Suite Health card with pass rate bars (if report has suite relations)
4. Dashboard shows Attention Required card with failed/flaky tests (or empty state message)
5. Dashboard shows Quick Insights card with top failures and slowest tests (or empty state per section)
6. Clicking a test in Attention Required or Quick Insights opens test details
</verification>

<success_criteria>
- Suite Health section shows pass rates by suite as horizontal progress bars
- Attention Required section lists failed tests with "Failed" badge and flaky tests with "Flaky" badge
- Quick Insights shows two sections: Top Failures (sorted by historical failure count) and Slowest Tests (sorted by duration)
- All cards follow existing component patterns (observer, useRootStore, MUI components)
- Cards handle empty states gracefully with helpful messages
- Clicking tests navigates to test details view
</success_criteria>

<output>
After completion, create `.planning/phases/21-overview-dashboard/21-01-SUMMARY.md`
</output>
