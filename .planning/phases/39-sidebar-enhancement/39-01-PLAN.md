---
phase: 39-sidebar-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/RunInfoSidebar/index.tsx
autonomous: true

must_haves:
  truths:
    - "User sees Status field with green CheckCircle icon showing 'Passed' when no failures"
    - "User sees Status field with red XCircle icon showing 'Failed' when failures exist"
    - "User sees Started at field with Calendar icon and formatted datetime"
    - "User sees Total Time field with Clock icon and duration"
    - "User sees Finished at field with Calendar icon and formatted datetime"
    - "User sees 'X of Y tests' count below Pass Rate percentage in completion ring"
  artifacts:
    - path: "src/components/RunInfoSidebar/index.tsx"
      provides: "Enhanced sidebar with status, timestamps, and test count"
      contains: "CheckCircle|XCircle|Calendar|Clock"
  key_links:
    - from: "src/components/RunInfoSidebar/index.tsx"
      to: "reportStore.runData.stats"
      via: "stats.failed > 0 for status determination"
      pattern: "stats\\.failed\\s*>\\s*0"
    - from: "src/components/RunInfoSidebar/index.tsx"
      to: "reportStore.runData.execution"
      via: "start_time and end_time for formatted timestamps"
      pattern: "execution\\.(start_time|end_time)"
---

<objective>
Enhance RunInfoSidebar with structured run information fields (Status, Started at, Total Time, Finished at) using icons, and improve the completion ring to display "X of Y tests" count below the percentage.

Purpose: Transform the sidebar from basic metadata display to comprehensive run information panel matching Qase TMS style
Output: Enhanced RunInfoSidebar.tsx with 4 new icon-labeled fields and improved completion ring
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-sidebar-enhancement/39-RESEARCH.md
@src/components/RunInfoSidebar/index.tsx
@src/schemas/QaseRun.schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add run information fields with icons</name>
  <files>src/components/RunInfoSidebar/index.tsx</files>
  <action>
Add new run information section to RunInfoSidebar between completion ring and statistics section.

1. Import icons from lucide-react: CheckCircle, XCircle, Calendar, Clock

2. Add status determination logic after existing `ringColor` calculation:
   - const runStatus = stats.failed > 0 ? 'failed' : 'passed'
   - const StatusIcon = runStatus === 'passed' ? CheckCircle : XCircle
   - const statusColor = runStatus === 'passed' ? 'text-green-500' : 'text-red-500'

3. Create dateFormatter instance (reuse existing pattern from line 29-32):
   - Already exists for formattedDate, use same formatter for both timestamps

4. Format end_time alongside start_time:
   - const formattedEndTime = dateFormatter.format(new Date(reportStore.runData.execution.end_time))

5. Replace existing metadata section (lines 105-120) with new icon-labeled fields:
```tsx
{/* Run information section with icons */}
<div className="pt-4 border-t space-y-3">
  {/* Status field */}
  <div className="flex items-center gap-2">
    <StatusIcon className={`w-4 h-4 ${statusColor}`} />
    <span className="text-xs text-muted-foreground">Status</span>
    <span className={`ml-auto font-medium ${statusColor}`}>
      {runStatus === 'passed' ? 'Passed' : 'Failed'}
    </span>
  </div>

  {/* Started at field */}
  <div className="flex items-start gap-2">
    <Calendar className="w-4 h-4 text-muted-foreground mt-0.5" />
    <div className="flex-1">
      <p className="text-xs text-muted-foreground">Started at</p>
      <p className="text-sm">{formattedDate}</p>
    </div>
  </div>

  {/* Total Time field */}
  <div className="flex items-start gap-2">
    <Clock className="w-4 h-4 text-muted-foreground mt-0.5" />
    <div className="flex-1">
      <p className="text-xs text-muted-foreground">Total Time</p>
      <p className="text-sm">{reportStore.formattedDuration}</p>
    </div>
  </div>

  {/* Finished at field */}
  <div className="flex items-start gap-2">
    <Calendar className="w-4 h-4 text-muted-foreground mt-0.5" />
    <div className="flex-1">
      <p className="text-xs text-muted-foreground">Finished at</p>
      <p className="text-sm">{formattedEndTime}</p>
    </div>
  </div>

  {/* Environment (conditional, keep existing logic) */}
  {reportStore.runData.environment && (
    <div className="flex items-start gap-2">
      <div className="w-4" /> {/* Spacer for alignment */}
      <div className="flex-1">
        <p className="text-xs text-muted-foreground">Environment</p>
        <p className="text-sm">{reportStore.runData.environment}</p>
      </div>
    </div>
  )}
</div>
```

Note: Use items-start with mt-0.5 on icons to align with first line of multi-line text.
  </action>
  <verify>
    npm run build passes without TypeScript errors.
    Run `npm run dev` and load a report - verify Status field shows with correct icon color.
  </verify>
  <done>
    Status field displays with CheckCircle (green) when no failures, XCircle (red) when failures exist.
    Started at, Total Time, Finished at fields display with Calendar/Clock icons.
    All timestamps use consistent Intl.DateTimeFormat formatting.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance completion ring with test count</name>
  <files>src/components/RunInfoSidebar/index.tsx</files>
  <action>
Enhance the completion ring section to display "X of Y tests" count below the Pass Rate label.

1. Add test count calculation after passRate (around line 15):
   - const passedCount = stats.passed
   - const totalCount = stats.total

2. Update the completion ring label section (currently lines 77-78) to include count:

Replace:
```tsx
<p className="text-sm text-muted-foreground">Pass Rate</p>
```

With:
```tsx
<div className="text-center">
  <p className="text-sm text-muted-foreground">Pass Rate</p>
  <p className="text-xs text-muted-foreground">
    {passedCount} of {totalCount} tests
  </p>
</div>
```

Note: Show passed count (not completed count) to match the percentage semantically - "X of Y passed" aligns with "pass rate".
  </action>
  <verify>
    npm run build passes without TypeScript errors.
    Run `npm run dev` and load a report - verify completion ring shows "X of Y tests" below "Pass Rate".
  </verify>
  <done>
    Completion ring displays percentage in center with "Pass Rate" label and "X of Y tests" count below.
    Count shows passed tests vs total tests, matching the pass rate percentage.
  </done>
</task>

</tasks>

<verification>
1. Build verification: `npm run build` completes without errors
2. Visual verification: Load report with failures - Status shows red XCircle with "Failed"
3. Visual verification: Load report with all passed - Status shows green CheckCircle with "Passed"
4. Visual verification: Started at and Finished at show consistent datetime format
5. Visual verification: Total Time shows formatted duration (e.g., "15m 23s")
6. Visual verification: Completion ring shows "X of Y tests" below Pass Rate
7. Icon alignment: All icons align with first line of their respective labels
</verification>

<success_criteria>
- SIDE-01: Status field displays with CheckCircle (passed) or XCircle (failed) icon with matching color
- SIDE-02: Started at field shows calendar icon and formatted datetime from start_time
- SIDE-03: Total Time field shows clock icon and formatted duration from formattedDuration
- SIDE-04: Finished at field shows calendar icon and formatted datetime from end_time
- SIDE-05: Completion ring shows percentage with "Pass Rate" label and "X of Y tests" count
- All timestamps use consistent Intl.DateTimeFormat('en-US', { dateStyle: 'medium', timeStyle: 'short' })
- Build passes, no TypeScript errors, icons properly imported from lucide-react
</success_criteria>

<output>
After completion, create `.planning/phases/39-sidebar-enhancement/39-01-SUMMARY.md`
</output>
