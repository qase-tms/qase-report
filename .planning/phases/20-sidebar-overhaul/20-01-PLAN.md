---
phase: 20-sidebar-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/NavigationDrawer/index.tsx
  - src/components/SidebarStats/index.tsx
  - src/components/SidebarFilters/index.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar displays pass rate as circular progress ring"
    - "Quick stats (passed/failed/flaky counts) visible below ring"
    - "Navigation items have descriptive icons"
    - "Status and stability filters rendered as clickable chips"
    - "Filters persist when navigating between views"
  artifacts:
    - path: "src/components/SidebarStats/index.tsx"
      provides: "Pass rate ring and quick stats display"
      exports: ["SidebarStats"]
      min_lines: 40
    - path: "src/components/SidebarFilters/index.tsx"
      provides: "Status and grade filter chips"
      exports: ["SidebarFilters"]
      min_lines: 50
    - path: "src/components/NavigationDrawer/index.tsx"
      provides: "Enhanced navigation with stats, icons, and filters"
      contains: "SidebarStats"
  key_links:
    - from: "src/components/SidebarStats/index.tsx"
      to: "reportStore.passRate"
      via: "useRootStore hook"
      pattern: "reportStore\\.passRate"
    - from: "src/components/SidebarStats/index.tsx"
      to: "reportStore.runData.stats"
      via: "useRootStore hook"
      pattern: "runData\\?\\.stats"
    - from: "src/components/SidebarFilters/index.tsx"
      to: "testResultsStore.statusFilters"
      via: "useRootStore hook"
      pattern: "statusFilters"
    - from: "src/components/SidebarFilters/index.tsx"
      to: "testResultsStore.stabilityGradeFilters"
      via: "useRootStore hook"
      pattern: "stabilityGradeFilters"
    - from: "src/components/NavigationDrawer/index.tsx"
      to: "SidebarStats"
      via: "import and render"
      pattern: "import.*SidebarStats"
    - from: "src/components/NavigationDrawer/index.tsx"
      to: "SidebarFilters"
      via: "import and render"
      pattern: "import.*SidebarFilters"
---

<objective>
Enhance NavigationDrawer with stats visualization, descriptive icons, and filter chips.

Purpose: Transform the sidebar from a simple navigation menu into an information-rich panel that shows test health at a glance (pass rate ring, quick stats) and provides quick access to filters without navigating to test list.

Output: Updated NavigationDrawer with three new sections (stats ring, quick stats, filter chips) and improved navigation icons for all views.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-sidebar-overhaul/20-RESEARCH.md

# Existing patterns to follow
@src/components/Dashboard/ProgressRingCard.tsx
@src/components/TestList/TestListFilters.tsx
@src/components/TestList/StabilityGradeFilter.tsx
@src/components/NavigationDrawer/index.tsx
@src/store/TestResultsStore.ts
@src/store/ReportStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SidebarStats component with pass rate ring and quick stats</name>
  <files>src/components/SidebarStats/index.tsx</files>
  <action>
Create new component `src/components/SidebarStats/index.tsx` that displays:

1. **Pass Rate Ring** (reuse pattern from ProgressRingCard.tsx):
   - Use two overlapping CircularProgress components (background track + foreground value)
   - Size: 80px diameter, thickness: 4
   - Color logic: green >= 80%, yellow >= 50%, red < 50% (same as ProgressRingCard getColor function)
   - Center: percentage text (Typography variant="h6")
   - Label above ring: "Pass Rate" (Typography variant="caption")

2. **Quick Stats Row** below the ring:
   - Three stat boxes in a horizontal flex row with justify-content: space-around
   - Each box: centered text with count (Typography variant="h6") and label (Typography variant="caption")
   - Passed: green color (success.main), value from `reportStore.runData?.stats.passed`
   - Failed: red color (error.main), value from `reportStore.runData?.stats.failed`
   - Flaky: orange color (warning.main), value from `analyticsStore.flakyTestCount`

3. **Data access:**
   - Import `useRootStore` from `../../store`
   - Get `reportStore` and `analyticsStore` from root store
   - Guard: Return null if `!reportStore.runData` (no stats to show)
   - Wrap component with `observer()` from mobx-react-lite

4. **Styling:**
   - Container: Box with px: 2, py: 2, textAlign: center
   - Pass rate ring centered in container
   - Quick stats row with pt: 1.5 spacing below ring

Export: `export const SidebarStats = observer(() => { ... })`
  </action>
  <verify>
Run `npm run build` - no TypeScript errors.
Verify file exists and exports SidebarStats component.
  </verify>
  <done>
SidebarStats component created with pass rate ring (two-CircularProgress overlay) and quick stats row showing passed/failed/flaky counts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SidebarFilters component with status and grade chips</name>
  <files>src/components/SidebarFilters/index.tsx</files>
  <action>
Create new component `src/components/SidebarFilters/index.tsx` that displays filter chips:

1. **Status Filter Chips:**
   - Chips for: passed (success), failed (error), broken (warning), skipped (default)
   - Use same pattern as TestListFilters.tsx:
     - `variant={statusFilters.has(status) ? 'filled' : 'outlined'}`
     - `onClick={() => toggleStatusFilter(status)}`
     - `size="small"`
   - Label above: "Status" (Typography variant="caption", color="text.secondary", gutterBottom)
   - Chip container: Box with display: flex, gap: 0.5, flexWrap: wrap

2. **Grade Filter Chips:**
   - Chips for grades: A+ (success), A (success), B (info), C (warning), D (warning), F (error)
   - Use same pattern as StabilityGradeFilter.tsx:
     - `variant={stabilityGradeFilters.has(grade) ? 'filled' : 'outlined'}`
     - `onClick={() => toggleStabilityGradeFilter(grade)}`
     - `size="small"`
   - Label above: "Grade" (Typography variant="caption", color="text.secondary", gutterBottom)
   - Spacing: mt: 1.5 between status and grade sections

3. **Data access:**
   - Import `useRootStore` from `../../store`
   - Get `testResultsStore` from root store
   - Destructure: `{ statusFilters, toggleStatusFilter, stabilityGradeFilters, toggleStabilityGradeFilter }`
   - Import `StabilityGrade` type from `../../types/stability`

4. **Styling:**
   - Container: Box with px: 2, py: 1
   - Compact layout suitable for sidebar width

Export: `export const SidebarFilters = observer(() => { ... })`
  </action>
  <verify>
Run `npm run build` - no TypeScript errors.
Verify file exists and exports SidebarFilters component.
  </verify>
  <done>
SidebarFilters component created with status chips (passed/failed/broken/skipped) and grade chips (A+/A/B/C/D/F) that toggle filter state via MobX store.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate stats, filters, and icons into NavigationDrawer</name>
  <files>src/components/NavigationDrawer/index.tsx</files>
  <action>
Update `src/components/NavigationDrawer/index.tsx` to add:

1. **Import new components and icons:**
   ```typescript
   import { SidebarStats } from '../SidebarStats'
   import { SidebarFilters } from '../SidebarFilters'
   import {
     // Keep existing
     Dashboard as DashboardIcon,
     ChevronLeft as ChevronLeftIcon,
     ChevronRight as ChevronRightIcon,
     // New icons for views
     FormatListBulleted as TestsIcon,        // Tests view
     ErrorOutline as FailureClustersIcon,    // Failure Clusters (future)
     Collections as GalleryIcon,             // Gallery (future)
     CompareArrows as ComparisonIcon,        // Comparison (future)
   } from '@mui/icons-material'
   import { Divider } from '@mui/material'
   ```

2. **Update navItems array with new icons:**
   ```typescript
   const navItems = [
     { id: 'dashboard' as const, label: 'Dashboard', icon: <DashboardIcon /> },
     { id: 'tests' as const, label: 'Tests', icon: <TestsIcon /> },
     // Analytics renamed to Failure Clusters (placeholder for future)
     { id: 'analytics' as const, label: 'Analytics', icon: <FailureClustersIcon /> },
   ]
   ```
   Note: Keep analytics id for backward compatibility - will be renamed in Phase 22.

3. **Add stats section after Toolbar (only when expanded and data loaded):**
   ```typescript
   <Toolbar variant="dense" />
   {!isNavigationCollapsed && <SidebarStats />}
   {!isNavigationCollapsed && <Divider />}
   ```

4. **Add filters section after List (only when expanded):**
   ```typescript
   </List>
   {!isNavigationCollapsed && <Divider />}
   {!isNavigationCollapsed && <SidebarFilters />}
   <Box sx={{ flexGrow: 1 }} />
   ```

5. **Full structure after changes:**
   - Toolbar (spacer)
   - SidebarStats (when expanded, guarded by reportStore.runData inside component)
   - Divider (when expanded)
   - List (navigation items with new icons)
   - Divider (when expanded)
   - SidebarFilters (when expanded)
   - Box (flexGrow spacer)
   - Box (collapse toggle)

Note: SidebarStats internally returns null when no data loaded, so no additional guard needed in NavigationDrawer.
  </action>
  <verify>
Run `npm run dev` and verify:
1. Pass rate ring displays when report loaded and sidebar expanded
2. Quick stats show correct passed/failed/flaky counts
3. Navigation icons visible for all items
4. Filter chips toggle correctly (filled/outlined state changes)
5. Filters persist when switching between Dashboard and Tests views
6. Collapsed sidebar shows only icons (no stats, no filters)
  </verify>
  <done>
NavigationDrawer displays pass rate ring, quick stats, descriptive navigation icons, and filter chips. Stats and filters hidden when collapsed. Filters persist via MobX state.
  </done>
</task>

</tasks>

<verification>
All requirements validated:
- SIDE-01: Pass rate ring displays with correct percentage and color coding
- SIDE-02: Quick stats show passed/failed/flaky counts below ring
- SIDE-03: Navigation items have descriptive icons (Dashboard, Tests, Analytics)
- SIDE-04: Status and grade filters as clickable chips in sidebar

Commands:
```bash
npm run build  # TypeScript compiles without errors
npm run dev    # Visual verification of sidebar features
```

Manual checks:
1. Load a test report
2. Verify pass rate ring shows correct percentage
3. Verify quick stats match dashboard counts
4. Click filter chips - verify they toggle filled/outlined
5. Navigate Dashboard -> Tests - verify filters persist
6. Collapse sidebar - verify only icons visible
</verification>

<success_criteria>
1. Pass rate circular progress ring visible in expanded sidebar (when report loaded)
2. Quick stats row shows passed (green), failed (red), flaky (orange) counts
3. Navigation items display appropriate icons (Dashboard, FormatListBulleted, ErrorOutline)
4. Status filter chips (passed/failed/broken/skipped) toggle correctly
5. Grade filter chips (A+/A/B/C/D/F) toggle correctly
6. Filter state persists when switching between Dashboard and Tests views
7. Collapsed sidebar shows only navigation icons (no stats, no filters)
8. `npm run build` completes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-sidebar-overhaul/20-01-SUMMARY.md`
</output>
