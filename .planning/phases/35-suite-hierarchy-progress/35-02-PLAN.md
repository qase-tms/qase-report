---
phase: 35-suite-hierarchy-progress
plan: 02
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - src/components/ui/tooltip.tsx
  - src/components/TestList/MultiSegmentProgress.tsx
  - src/components/TestList/columns.tsx
autonomous: true

must_haves:
  truths:
    - "Progress bar for each suite shows pass/fail segments"
    - "Progress bar colors: green (passed), red (failed), yellow (skipped), gray (broken)"
    - "Suite duration displays in progress bar tooltip"
    - "Progress bar is accessible via keyboard focus"
  artifacts:
    - path: "src/components/ui/tooltip.tsx"
      provides: "shadcn/ui Tooltip component"
      exports: ["Tooltip", "TooltipTrigger", "TooltipContent", "TooltipProvider"]
    - path: "src/components/TestList/MultiSegmentProgress.tsx"
      provides: "Multi-color progress bar component"
      exports: ["MultiSegmentProgress"]
    - path: "src/components/TestList/columns.tsx"
      provides: "Progress column for suites"
      contains: "MultiSegmentProgress"
  key_links:
    - from: "src/components/TestList/columns.tsx"
      to: "MultiSegmentProgress"
      via: "cell renderer import"
      pattern: "import.*MultiSegmentProgress"
    - from: "src/components/TestList/MultiSegmentProgress.tsx"
      to: "@radix-ui/react-progress"
      via: "Progress primitive"
      pattern: "ProgressPrimitive"
---

<objective>
Create multi-segment progress bar component and integrate into suite rows for visualizing pass/fail/skipped/broken proportions.

Purpose: Provide visual feedback on suite health through color-coded progress bars that show test status breakdown with accessible tooltips displaying duration and counts.

Output: shadcn/ui Tooltip installed, MultiSegmentProgress component, columns updated with Progress column for suites.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-suite-hierarchy-progress/35-RESEARCH.md
@.planning/phases/35-suite-hierarchy-progress/35-01-PLAN.md
@src/components/TestList/buildSuiteTree.ts
@src/components/TestList/columns.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Tooltip and create MultiSegmentProgress component</name>
  <files>
src/components/ui/tooltip.tsx
src/components/TestList/MultiSegmentProgress.tsx
  </files>
  <action>
**Step 1: Install shadcn/ui Tooltip component:**
```bash
npx shadcn@latest add tooltip -y
```

This creates `src/components/ui/tooltip.tsx` with Radix UI primitives.

**Step 2: Create MultiSegmentProgress component:**

Create `src/components/TestList/MultiSegmentProgress.tsx`:

```typescript
import * as ProgressPrimitive from '@radix-ui/react-progress'
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '../ui/tooltip'
import { cn } from '../../lib/utils'

export type ProgressSegment = {
  value: number      // Cumulative percentage (0-100)
  color: string      // Tailwind class: bg-green-500, etc.
  label: string      // For tooltip: "Passed: 10"
  count: number      // Actual count
}

interface MultiSegmentProgressProps {
  segments: ProgressSegment[]
  duration: number
  className?: string
}

export function MultiSegmentProgress({
  segments,
  duration,
  className,
}: MultiSegmentProgressProps) {
  // Sort segments by value ascending for correct z-index stacking
  const sortedSegments = [...segments]
    .filter((s) => s.value > 0)
    .sort((a, b) => a.value - b.value)

  // Format duration helper
  const formatDuration = (ms: number): string => {
    if (ms >= 1000) return `${(ms / 1000).toFixed(1)}s`
    return `${ms}ms`
  }

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <div
            className={cn('w-full', className)}
            role="progressbar"
            aria-label="Suite progress"
          >
            <ProgressPrimitive.Root
              className="relative h-3 w-full overflow-hidden rounded-full bg-secondary"
            >
              {sortedSegments.map((segment, index) => (
                <ProgressPrimitive.Indicator
                  key={index}
                  className={cn(segment.color, 'h-full transition-all')}
                  style={{
                    width: `${segment.value}%`,
                    left: '0%',
                    position: 'absolute',
                    // Higher z-index for smaller segments (they stack on top)
                    zIndex: sortedSegments.length - index,
                  }}
                />
              ))}
            </ProgressPrimitive.Root>
          </div>
        </TooltipTrigger>
        <TooltipContent side="top" className="text-xs">
          <div className="space-y-1">
            <div className="font-medium">Duration: {formatDuration(duration)}</div>
            <div className="border-t border-border pt-1 mt-1 space-y-0.5">
              {segments.map((seg, i) => (
                <div key={i} className="flex items-center gap-2">
                  <div className={cn('w-2 h-2 rounded-full', seg.color)} />
                  <span>{seg.label}</span>
                </div>
              ))}
            </div>
          </div>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  )
}
```

**Key implementation details:**
- Segments use CUMULATIVE percentages (not individual widths)
- Sorted ascending by value, z-index in reverse order
- Radix ProgressPrimitive for accessibility
- Tooltip shows duration and breakdown counts
- Uses Tailwind color classes for status colors
  </action>
  <verify>
```bash
# Check Tooltip component installed
ls -la src/components/ui/tooltip.tsx

# Check MultiSegmentProgress exports
grep "export function MultiSegmentProgress" src/components/TestList/MultiSegmentProgress.tsx

# Check ProgressPrimitive import
grep "@radix-ui/react-progress" src/components/TestList/MultiSegmentProgress.tsx

# Build verification
npm run build 2>&1 | head -20
```
  </verify>
  <done>
- shadcn/ui Tooltip installed at src/components/ui/tooltip.tsx
- MultiSegmentProgress exports ProgressSegment type and component
- Component uses Radix ProgressPrimitive with cumulative percentages
- Tooltip displays duration and status breakdown
- Build passes without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Progress column to columns.tsx for suite rows</name>
  <files>src/components/TestList/columns.tsx</files>
  <action>
Update columns.tsx to add a Progress column that shows multi-segment progress bar for suite rows.

**Add import:**
```typescript
import { MultiSegmentProgress, type ProgressSegment } from './MultiSegmentProgress'
```

**Add new Progress column after Status column:**

```typescript
{
  id: 'progress',
  header: 'Progress',
  cell: ({ row }) => {
    // Only show progress for suite rows
    if (row.original.type !== 'suite') return null

    const {
      totalTests = 0,
      passedCount = 0,
      failedCount = 0,
      skippedCount = 0,
      brokenCount = 0,
      totalDuration = 0,
    } = row.original

    // Handle empty suite
    if (totalTests === 0) {
      return (
        <span className="text-xs text-muted-foreground">No tests</span>
      )
    }

    // Calculate cumulative percentages
    // Order: passed -> failed -> skipped -> broken
    const passedPct = (passedCount / totalTests) * 100
    const failedPct = passedPct + (failedCount / totalTests) * 100
    const skippedPct = failedPct + (skippedCount / totalTests) * 100
    const brokenPct = skippedPct + (brokenCount / totalTests) * 100

    const segments: ProgressSegment[] = [
      {
        value: passedPct,
        color: 'bg-green-500',
        label: `Passed: ${passedCount}`,
        count: passedCount,
      },
      {
        value: failedPct,
        color: 'bg-red-500',
        label: `Failed: ${failedCount}`,
        count: failedCount,
      },
      {
        value: skippedPct,
        color: 'bg-yellow-500',
        label: `Skipped: ${skippedCount}`,
        count: skippedCount,
      },
      {
        value: brokenPct,
        color: 'bg-gray-500',
        label: `Broken: ${brokenCount}`,
        count: brokenCount,
      },
    ]

    return (
      <div className="w-32">
        <MultiSegmentProgress
          segments={segments}
          duration={totalDuration}
        />
      </div>
    )
  },
  size: 150,
},
```

**Update column order in array:**
1. name (with expand chevron)
2. execution.status (for test rows only)
3. progress (NEW - for suite rows only)
4. execution.duration
5. actions

**Progress bar colors from requirements:**
- Green (bg-green-500): passed
- Red (bg-red-500): failed
- Yellow (bg-yellow-500): skipped
- Gray (bg-gray-500): broken

**Tooltip shows:**
- Duration formatted as X.Xs or Xms
- Breakdown: Passed: N, Failed: N, Skipped: N, Broken: N
  </action>
  <verify>
```bash
# Check MultiSegmentProgress import
grep "import.*MultiSegmentProgress" src/components/TestList/columns.tsx

# Check Progress column exists
grep -A5 "id: 'progress'" src/components/TestList/columns.tsx

# Check cumulative percentage calculation
grep "passedPct.*failedPct.*skippedPct" src/components/TestList/columns.tsx

# Build to verify
npm run build
```
  </verify>
  <done>
- Progress column added to columns array
- Only renders for suite rows (type === 'suite')
- Calculates cumulative percentages correctly
- Uses correct colors: green/red/yellow/gray for passed/failed/skipped/broken
- Shows "No tests" badge for empty suites
- Build passes without errors
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npm run build` succeeds
2. Tooltip installed: `ls src/components/ui/tooltip.tsx` exists
3. MultiSegmentProgress: Exports component with correct props
4. Progress column: Shows multi-color bar for suites only

Manual verification:
- Load test report with multiple suites
- See progress bars on suite rows
- Hover progress bar to see tooltip with duration and counts
- Tab to focus progress bar (keyboard accessibility)
- Colors match: green=passed, red=failed, yellow=skipped, gray=broken
</verification>

<success_criteria>
- [ ] shadcn/ui Tooltip component installed
- [ ] MultiSegmentProgress component created with Radix primitives
- [ ] Progress column added to columns.tsx
- [ ] Suite rows show multi-segment progress bar
- [ ] Test rows show nothing in Progress column
- [ ] Tooltip displays duration and status breakdown
- [ ] npm run build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/35-suite-hierarchy-progress/35-02-SUMMARY.md`
</output>
