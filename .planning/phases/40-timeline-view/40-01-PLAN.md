---
phase: 40-timeline-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/index.tsx
  - src/components/TabNavigation/index.tsx
  - src/layout/MainLayout/index.tsx
  - src/components/Timeline/index.tsx
  - src/components/Timeline/TimelineBar.tsx
  - src/components/Timeline/TimelineAxis.tsx
autonomous: false

must_haves:
  truths:
    - "User sees Timeline tab in horizontal tab navigation"
    - "User clicks Timeline tab and views timeline visualization"
    - "Timeline shows tests as horizontal bars with start/end times"
    - "Timeline groups tests by thread in separate swimlanes"
    - "User clicks test bar and TestDetailsDrawer opens"
  artifacts:
    - path: "src/components/Timeline/index.tsx"
      provides: "Main timeline container with swimlanes"
      min_lines: 80
    - path: "src/components/Timeline/TimelineBar.tsx"
      provides: "Individual test bar with click handler"
      min_lines: 40
    - path: "src/components/Timeline/TimelineAxis.tsx"
      provides: "Time axis with scale markers"
      min_lines: 30
    - path: "src/store/index.tsx"
      provides: "activeView includes 'timeline'"
      contains: "timeline"
    - path: "src/components/TabNavigation/index.tsx"
      provides: "Timeline tab with Clock icon"
      contains: "timeline"
  key_links:
    - from: "src/components/TabNavigation/index.tsx"
      to: "RootStore.setActiveView('timeline')"
      via: "Tab click handler"
      pattern: "setActiveView.*timeline"
    - from: "src/layout/MainLayout/index.tsx"
      to: "src/components/Timeline/index.tsx"
      via: "renderView() conditional"
      pattern: "activeView.*timeline.*Timeline"
    - from: "src/components/Timeline/TimelineBar.tsx"
      to: "RootStore.selectTest()"
      via: "onClick handler"
      pattern: "selectTest.*test\\.id"
---

<objective>
Add Timeline view to application showing test execution sequence over time with thread-based swimlanes.

Purpose: Users can visualize which tests ran in parallel vs sequentially and understand execution flow at a glance
Output: Timeline tab in navigation with custom timeline visualization component
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-timeline-view/40-RESEARCH.md

# Reference recent navigation pattern
@.planning/phases/32-layout-restructure/32-03-SUMMARY.md

# Reference test data structure
@src/schemas/QaseTestResult.schema.ts
@src/store/index.tsx
@src/components/TabNavigation/index.tsx
@src/layout/MainLayout/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Timeline to Navigation</name>
  <files>
src/store/index.tsx
src/components/TabNavigation/index.tsx
src/layout/MainLayout/index.tsx
  </files>
  <action>
Update RootStore to include 'timeline' in activeView type and setActiveView method:

In src/store/index.tsx:
- Update activeView type from: `'dashboard' | 'tests' | 'analytics' | 'failure-clusters' | 'gallery' | 'comparison'`
- To: `'dashboard' | 'tests' | 'analytics' | 'failure-clusters' | 'gallery' | 'comparison' | 'timeline'`
- Update setActiveView parameter type to match (add 'timeline')

In src/components/TabNavigation/index.tsx:
- Import Clock icon: `import { Clock } from 'lucide-react'`
- Add timeline tab to tabs array (after comparison):
  ```tsx
  { value: 'timeline', label: 'Timeline', icon: Clock }
  ```
- Update onValueChange type cast to include 'timeline'

In src/layout/MainLayout/index.tsx:
- Add Timeline import: `import { Timeline } from '../../components/Timeline'`
- Add timeline case to renderView() function (after comparison):
  ```tsx
  if (activeView === 'timeline') {
    return <Timeline />
  }
  ```

Follow existing patterns from other tabs (dashboard, tests, failure-clusters, gallery, comparison). Timeline tab should be last in navigation order.
  </action>
  <verify>
1. Run `npm run build` - should compile without TypeScript errors
2. Check src/store/index.tsx contains 'timeline' in activeView type
3. Check src/components/TabNavigation/index.tsx contains Clock icon and timeline tab
4. Check src/layout/MainLayout/index.tsx contains Timeline import and timeline case
  </verify>
  <done>
- Timeline tab visible in horizontal tab navigation with Clock icon
- Clicking Timeline tab updates activeView to 'timeline'
- MainLayout ready to render Timeline component when activeView is 'timeline'
- TypeScript compilation passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Timeline Visualization Component</name>
  <files>
src/components/Timeline/index.tsx
src/components/Timeline/TimelineBar.tsx
src/components/Timeline/TimelineAxis.tsx
  </files>
  <action>
Create Timeline component following research patterns (custom component with Tailwind CSS, no new dependencies).

Create src/components/Timeline/index.tsx:
- Import: observer, useRootStore, Card from '../ui/card', Badge from '../ui/badge', Clock from lucide-react, QaseTestResult type
- Observer-wrapped component accessing testResultsStore and reportStore
- Empty state: No report loaded → show Clock icon + message
- Empty state: No tests with timing data → show Clock icon + message
- Calculate timeline bounds: minTime = Math.min(start_time), maxTime = Math.max(end_time), totalDuration = maxTime - minTime
- Group tests by thread: `test.execution.thread || 'main'` using reduce into Record<string, QaseTestResult[]>
- Render Card with:
  - Header: "Test Execution Timeline" + summary (duration, test count, thread count)
  - Legend: 4 Badge components (Passed/Failed/Broken/Skipped with outline variant and color backgrounds)
  - TimelineAxis component passing minTime, maxTime
  - Swimlanes: Map over groupedByThread, each with border-l-2 border-muted, thread label, relative container (h-12 bg-muted/20 rounded)
  - TimelineBar for each test in swimlane passing test, minTime, totalDuration
- Format duration helper: Convert ms to "Xh Ym", "Xm Ys", or "Xs" format

Create src/components/Timeline/TimelineBar.tsx:
- Import: observer, useRootStore, QaseTestResult type
- Props: test (QaseTestResult), minTime (number), totalDuration (number)
- Calculate positioning: startOffset = ((start_time - minTime) / totalDuration) * 100
- Calculate width: width = (duration / totalDuration) * 100 (minimum 0.5% for visibility)
- Status color classes: passed=bg-green-500 hover:bg-green-600, failed=bg-red-500 hover:bg-red-600, broken=bg-yellow-500 hover:bg-yellow-600, skipped=bg-gray-500 hover:bg-gray-600
- Render absolute positioned div with:
  - Style: left={startOffset}%, width={width}%
  - Classes: absolute h-10 rounded flex items-center px-2 text-xs text-white cursor-pointer transition-colors truncate + color classes
  - onClick: selectTest(test.id) to open TestDetailsDrawer
  - title attribute: "{test.title} ({duration formatted})"
  - Content: truncated test.title
- Format duration helper: ms to "Xm Ys" or "Xs"

Create src/components/Timeline/TimelineAxis.tsx:
- Props: minTime (number), maxTime (number)
- Calculate 5 time markers at [0, 0.25, 0.5, 0.75, 1] ratios
- Each marker: position (0-100%), time (new Date(minTime + duration * ratio))
- Render relative container (h-12 border-b border-border mb-4) with:
  - Map markers to absolute positioned divs at left={position}%
  - Each marker: time text (toLocaleTimeString with 2-digit hour/minute/second), vertical tick line (h-2 w-px bg-border)
  - Center alignment with -translate-x-1/2
  - Text: text-xs text-muted-foreground

Use CSS percentage-based positioning (NOT pixel widths) for responsive layout. Use shadcn/ui Card and Badge components for consistency. Follow MobX observer pattern for reactivity.
  </action>
  <verify>
1. Run `npm run build` - should compile without TypeScript errors
2. Check src/components/Timeline/index.tsx exists and exports Timeline component
3. Check src/components/Timeline/TimelineBar.tsx exists and exports TimelineBar component
4. Check src/components/Timeline/TimelineAxis.tsx exists and exports TimelineAxis component
5. Verify observer() wrapper on Timeline component
6. Verify useRootStore() hook usage in Timeline and TimelineBar
7. Verify CSS percentage positioning (left: X%, width: Y%) in TimelineBar
8. Verify selectTest() onClick handler in TimelineBar
  </verify>
  <done>
- Timeline component renders with Card layout and header
- Empty states handle no report and no timing data cases
- TimelineAxis displays 5 time markers across horizontal axis
- TimelineBar renders tests as horizontal bars with correct positioning
- Tests grouped into thread-based swimlanes
- Clicking test bar calls selectTest() to open TestDetailsDrawer
- TypeScript compilation passes
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Timeline view with thread-based swimlanes showing test execution sequence:
- Timeline tab in navigation (Clock icon)
- Timeline visualization with horizontal test bars
- Time axis with scale markers
- Thread-based swimlanes for parallel execution
- Color-coded status (green/red/yellow/gray)
- Click test bar to open details drawer
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open application in browser (http://localhost:5173)
3. Load a test report (use sample report with multiple tests)
4. Click "Timeline" tab in horizontal navigation
5. Verify Timeline view displays with:
   - Title "Test Execution Timeline" and summary line
   - Legend showing 4 status badges (Passed, Failed, Broken, Skipped)
   - Time axis with 5 time markers showing timestamps
   - Thread swimlanes (one or more rows labeled "Thread: X")
   - Horizontal bars representing tests with colors (green=passed, red=failed, etc.)
6. Test interactions:
   - Hover over test bar → cursor changes to pointer, color darkens slightly
   - Click test bar → TestDetailsDrawer opens on right side with test details
   - Verify timeline shows parallel execution if tests have different thread values
7. Test empty states:
   - Refresh without loading report → see "No report loaded" message with Clock icon
   - (If applicable) Load report with no timing data → see "No test timing data available" message
8. Responsive check:
   - Resize browser window → timeline bars scale proportionally (percentage-based)
   - Verify layout doesn't break on narrow screens
  </how-to-verify>
  <resume-signal>Type "approved" if timeline displays correctly and interactions work, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After Task 3 approval:

1. Final build check: `npm run build` passes without errors
2. File structure check: Timeline directory exists with 3 files (index.tsx, TimelineBar.tsx, TimelineAxis.tsx)
3. Integration check: Timeline tab visible in production build
4. Navigation check: Clicking Timeline tab switches to timeline view
5. Visualization check: Timeline displays test execution with swimlanes
6. Interaction check: Clicking test bar opens TestDetailsDrawer
</verification>

<success_criteria>
Phase 40 complete when:

- [x] TIME-01: User can access Timeline tab from main navigation tabs
- [x] TIME-02: Timeline shows test execution over time with visualization
- [x] User sees Timeline tab with Clock icon in horizontal navigation
- [x] Timeline view displays test execution sequence as horizontal bars
- [x] Timeline shows parallel vs sequential execution via thread swimlanes
- [x] Timeline visualization makes execution flow clear at a glance
- [x] User can click test bar to open TestDetailsDrawer
- [x] Empty states handle no report and no timing data cases
- [x] TypeScript compilation passes
- [x] Production build works correctly
- [x] Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/40-timeline-view/40-01-SUMMARY.md` using the summary template.

Document:
- Implementation approach (custom component with CSS positioning, no new dependencies)
- Thread-based swimlane pattern for parallel execution visualization
- CSS percentage positioning for responsive timeline bars
- Integration with existing TestDetailsDrawer via selectTest()
- Any deviations from plan or issues encountered
</output>
