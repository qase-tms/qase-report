---
phase: 14-sidebar-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/index.tsx
  - src/components/NavigationDrawer/index.tsx
  - src/App.tsx
  - src/layout/MainLayout/index.tsx
autonomous: true

must_haves:
  truths:
    - "User sees left sidebar with Dashboard, Tests, Analytics navigation items"
    - "User can collapse sidebar to icon-only mode (64px width)"
    - "User can expand sidebar back to full width (240px)"
    - "Active view is visually highlighted with selected state"
    - "Sidebar collapsed/expanded state persists across browser sessions"
  artifacts:
    - path: "src/store/index.tsx"
      provides: "Navigation state management"
      contains: "isNavigationCollapsed"
    - path: "src/components/NavigationDrawer/index.tsx"
      provides: "Left-side navigation drawer component"
      exports: ["NavigationDrawer"]
    - path: "src/App.tsx"
      provides: "Layout coordination with drawer"
      contains: "NavigationDrawer"
    - path: "src/layout/MainLayout/index.tsx"
      provides: "View switching based on activeView"
      contains: "activeView"
  key_links:
    - from: "src/components/NavigationDrawer/index.tsx"
      to: "src/store/index.tsx"
      via: "useRootStore hook"
      pattern: "isNavigationCollapsed|activeView|toggleNavigation"
    - from: "src/layout/MainLayout/index.tsx"
      to: "src/store/index.tsx"
      via: "useRootStore hook"
      pattern: "activeView"
    - from: "src/store/index.tsx"
      to: "localStorage"
      via: "persistence"
      pattern: "localStorage\\.setItem.*navigationCollapsed"
---

<objective>
Implement persistent left-side navigation sidebar with collapsible state

Purpose: Users navigate between Dashboard, Tests, and Analytics views via a persistent sidebar that can collapse to icon-only mode for more content space. State persists across sessions.

Output: NavigationDrawer component integrated into App layout with MobX state management
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-sidebar-navigation/14-RESEARCH.md

@src/store/index.tsx
@src/App.tsx
@src/layout/MainLayout/index.tsx
@src/components/Sidebar/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add navigation state to RootStore</name>
  <files>src/store/index.tsx</files>
  <action>
Add navigation state management to RootStore class:

1. Add observable properties:
   - `isNavigationCollapsed: boolean = false` - controls drawer width
   - `activeView: 'dashboard' | 'tests' | 'analytics' = 'dashboard'` - current view

2. Add actions:
   - `toggleNavigation()` - toggles isNavigationCollapsed and persists to localStorage
   - `setActiveView(view)` - sets activeView

3. Add localStorage persistence in constructor:
   - Read 'navigationCollapsed' from localStorage on init
   - Wrap JSON.parse in try-catch for safety
   - Save to localStorage in toggleNavigation action

Pattern from research:
```typescript
// In constructor after makeAutoObservable
const stored = localStorage.getItem('navigationCollapsed')
if (stored !== null) {
  try {
    this.isNavigationCollapsed = JSON.parse(stored)
  } catch (e) {
    console.warn('Failed to parse navigation state')
  }
}
```

Note: Do NOT modify existing properties (isDockOpen, selectedTestId, etc.) - add new navigation state alongside them.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>RootStore has isNavigationCollapsed, activeView, toggleNavigation, setActiveView with localStorage persistence</done>
</task>

<task type="auto">
  <name>Task 2: Create NavigationDrawer component</name>
  <files>src/components/NavigationDrawer/index.tsx</files>
  <action>
Create new NavigationDrawer component with MUI permanent Drawer and mini variant pattern:

1. Constants:
   - `DRAWER_WIDTH_EXPANDED = 240`
   - `DRAWER_WIDTH_COLLAPSED = 64`

2. Component structure:
   - Use MUI Drawer with `variant="permanent"` and `anchor="left"`
   - Width transitions using theme.transitions.create('width')
   - Toolbar spacer at top to account for AppBar
   - Navigation List with three items: Dashboard, Tests, Analytics

3. Navigation items (use ListItemButton with selected prop):
   - Dashboard: DashboardIcon, onClick sets activeView to 'dashboard'
   - Tests: AssignmentIcon (or ListAltIcon), onClick sets activeView to 'tests'
   - Analytics: AnalyticsIcon (or InsightsIcon), onClick sets activeView to 'analytics'

4. Collapse toggle:
   - IconButton at bottom with ChevronLeftIcon (when expanded) / ChevronRightIcon (when collapsed)
   - onClick calls toggleNavigation from store

5. Styling for collapsed state:
   - ListItemButton: `justifyContent: collapsed ? 'center' : 'initial'`
   - ListItemIcon: `mr: collapsed ? 'auto' : 3, justifyContent: 'center'`
   - ListItemText: conditionally render only when NOT collapsed

6. Accessibility:
   - Drawer: `aria-label="main navigation"`
   - Selected ListItemButton: `aria-current="page"`

7. Wrap component with observer() from mobx-react-lite

Use patterns from 14-RESEARCH.md for transitions and styling.
  </action>
  <verify>File exists and TypeScript compiles: `ls src/components/NavigationDrawer/index.tsx && npx tsc --noEmit`</verify>
  <done>NavigationDrawer component renders permanent drawer with Dashboard/Tests/Analytics items, collapse toggle, active state highlighting</done>
</task>

<task type="auto">
  <name>Task 3: Integrate NavigationDrawer into layout</name>
  <files>src/App.tsx, src/layout/MainLayout/index.tsx</files>
  <action>
Update App.tsx and MainLayout to integrate NavigationDrawer:

**App.tsx changes:**

1. Import NavigationDrawer and useRootStore
2. Wrap with observer()
3. Add Box with `display: 'flex'` as root container
4. Keep AppBar with `zIndex: theme.zIndex.drawer + 1` (already correct)
5. Add NavigationDrawer after AppBar
6. Wrap MainLayout in Box with left margin based on drawer width:
   ```typescript
   const drawerWidth = isNavigationCollapsed ? 64 : 240
   <Box
     component="main"
     sx={{
       flexGrow: 1,
       ml: `${drawerWidth}px`,
       transition: theme => theme.transitions.create('margin', {
         easing: theme.transitions.easing.sharp,
         duration: theme.transitions.duration.leavingScreen,
       }),
     }}
   >
   ```
7. Remove the standalone `<Toolbar variant={'dense'} />` spacer (now inside Box structure)

**MainLayout/index.tsx changes:**

1. Add activeView to destructured useRootStore() call
2. Replace the current conditional rendering logic with view switching:
   - If `activeView === 'dashboard'`: show Dashboard + TestList (current behavior)
   - If `activeView === 'tests'`: show only TestList (full focus on tests)
   - If `activeView === 'analytics'`: show placeholder Box with "Analytics - Coming Soon" message

3. Adjust Grid width from xs={10} to full width since sidebar now provides spacing
4. Keep existing Sidebar (right-side) for TestDetails - no changes to that

Note: The right-side Sidebar for test details (isDockOpen) remains unchanged - it's a separate temporary drawer that overlays when viewing test details.
  </action>
  <verify>
Run dev server and verify: `npm run dev`
- Left navigation drawer visible with Dashboard, Tests, Analytics items
- Clicking items switches view
- Collapse toggle works (drawer shrinks to 64px)
- Expanded state shows text labels, collapsed shows icons only
- Refresh page - drawer state persists
- Right-side test details drawer still works when clicking a test
  </verify>
  <done>NavigationDrawer integrated, view switching works, layout coordinates properly with AppBar and both drawers</done>
</task>

</tasks>

<verification>
1. Navigation drawer renders on left side with correct width (240px expanded, 64px collapsed)
2. Three navigation items visible: Dashboard, Tests, Analytics
3. Clicking navigation item changes activeView and highlights selected item
4. Collapse button toggles drawer between full and icon-only mode
5. Main content margin adjusts smoothly with drawer width changes
6. Refresh browser - drawer collapsed state is remembered
7. Test details sidebar (right side) still opens when clicking a test
8. AppBar remains above navigation drawer (z-index correct)
</verification>

<success_criteria>
- User sees left sidebar with Dashboard, Tests, Analytics sections
- User can collapse sidebar to icon-only mode (64px)
- User can expand collapsed sidebar back to full width (240px)
- Active view is visually highlighted in sidebar
- Sidebar state persists across browser sessions (survives refresh)
- Existing test details drawer (right side) continues to work
</success_criteria>

<output>
After completion, create `.planning/phases/14-sidebar-navigation/14-01-SUMMARY.md`
</output>
