---
phase: 44-cli-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.cli.json
  - src/cli/index.ts
autonomous: true

must_haves:
  truths:
    - "User runs `qase-report --help` and sees help with available commands"
    - "User runs `qase-report --version` and sees version number from package.json"
    - "User runs `qase-report` without arguments and sees help output"
  artifacts:
    - path: "src/cli/index.ts"
      provides: "CLI entry point with Commander.js"
      contains: "program.version"
    - path: "package.json"
      provides: "CLI binary configuration"
      contains: '"bin":'
    - path: "tsconfig.cli.json"
      provides: "TypeScript config for Node.js CLI"
      contains: '"module": "NodeNext"'
  key_links:
    - from: "package.json"
      to: "dist/cli/index.js"
      via: "bin field"
      pattern: '"qase-report".*"dist/cli'
    - from: "src/cli/index.ts"
      to: "package.json"
      via: "dynamic version import"
      pattern: "version.*package"
---

<objective>
Set up CLI foundation with Commander.js for argument parsing, help, and version commands.

Purpose: Enable users to invoke the CLI with `--help` and `--version` flags, establishing the foundation for `open` and `generate` commands in subsequent phases.

Output: Working CLI that responds to help/version flags and shows usage when run without arguments.
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure CLI build infrastructure</name>
  <files>package.json, tsconfig.cli.json</files>
  <action>
1. Install Commander.js:
   ```bash
   npm install commander
   ```

2. Update package.json:
   - Add "bin" field pointing to compiled CLI:
     ```json
     "bin": {
       "qase-report": "./dist/cli/index.js"
     }
     ```
   - Add CLI build script:
     ```json
     "build:cli": "tsc -p tsconfig.cli.json"
     ```
   - Update main build script to include CLI:
     ```json
     "build": "tsc && vite build && npm run build:cli"
     ```

3. Create tsconfig.cli.json for Node.js CLI compilation:
   - Module: NodeNext (ESM for Node.js)
   - Target: ES2022 (modern Node.js)
   - outDir: dist/cli
   - Include only src/cli/**/*
   - Emit declaration: false (no .d.ts needed)
   - rootDir: src/cli

Note: Keep CLI separate from Vite build to avoid bundling issues. CLI runs in Node.js, React app runs in browser.
  </action>
  <verify>
- `npm install` completes without errors
- `cat package.json | grep -A2 '"bin"'` shows qase-report entry
- `cat tsconfig.cli.json` shows NodeNext module setting
- `npm run build:cli` command is available (will fail until Task 2, but script exists)
  </verify>
  <done>package.json has bin field and build:cli script, tsconfig.cli.json exists with Node.js ESM configuration</done>
</task>

<task type="auto">
  <name>Task 2: Implement CLI entry point with help and version</name>
  <files>src/cli/index.ts</files>
  <action>
1. Create src/cli/index.ts with shebang and Commander.js setup:
   ```typescript
   #!/usr/bin/env node
   import { program } from 'commander'
   import { readFileSync } from 'fs'
   import { fileURLToPath } from 'url'
   import { dirname, join } from 'path'
   ```

2. Read version from package.json dynamically:
   - Use import.meta.url to get current file location
   - Navigate to package.json from dist/cli/ (../../package.json)
   - Parse JSON and extract version field

3. Configure Commander program:
   - name: 'qase-report'
   - description: 'Visualize Qase test reports in an interactive UI'
   - version: from package.json (use .version() method)
   - Add placeholder commands for future phases:
     - `open <path>` - "Open test results in browser (coming soon)"
     - `generate <path>` - "Generate static HTML report (coming soon)"
   - These commands should print "Coming soon" message when invoked

4. Configure help behavior:
   - Show help when no arguments provided (use program.showHelpAfterError())
   - Ensure --help flag works

5. Parse arguments:
   ```typescript
   program.parse(process.argv)

   // Show help if no command provided
   if (!process.argv.slice(2).length) {
     program.outputHelp()
   }
   ```

6. Add proper TypeScript types (Commander has built-in types).

Note: Use createRequire or fs.readFileSync for package.json - do NOT use import assertion (experimental in Node.js).
  </action>
  <verify>
Build and test CLI:
```bash
npm run build:cli
node dist/cli/index.js --help
node dist/cli/index.js --version
node dist/cli/index.js
node dist/cli/index.js open test
```

Expected:
- `--help` shows usage with open/generate commands listed
- `--version` shows "0.0.0" (current package.json version)
- No args shows help output
- `open test` shows "Coming soon" message
  </verify>
  <done>CLI responds correctly to --help (shows usage), --version (shows 0.0.0), and no args (shows help)</done>
</task>

<task type="auto">
  <name>Task 3: Link CLI for local development testing</name>
  <files>-</files>
  <action>
1. Run npm link to make CLI available globally for testing:
   ```bash
   npm link
   ```

2. Verify the linked CLI works:
   ```bash
   qase-report --help
   qase-report --version
   qase-report
   ```

3. Document in console output that user can unlink later with `npm unlink qase-report`.

Note: This is for development testing only. The npm link creates a symlink from global node_modules to the local project.
  </action>
  <verify>
```bash
qase-report --help
qase-report --version
qase-report
```

All three commands work from any directory, not just the project root.
  </verify>
  <done>CLI is accessible as `qase-report` command from any directory in the terminal</done>
</task>

</tasks>

<verification>
Run full verification sequence:

```bash
# Build CLI
npm run build:cli

# Test via node directly
node dist/cli/index.js --help
node dist/cli/index.js --version
node dist/cli/index.js

# Test via linked command
qase-report --help
qase-report --version
qase-report
```

All commands should produce correct output without errors.
</verification>

<success_criteria>
1. `qase-report --help` displays usage information showing available commands (open, generate)
2. `qase-report --version` displays "0.0.0" (current package.json version)
3. `qase-report` without arguments displays help output (same as --help)
4. CLI binary is accessible after `npm link` from any directory
</success_criteria>

<output>
After completion, create `.planning/phases/44-cli-foundation/44-01-SUMMARY.md`
</output>
