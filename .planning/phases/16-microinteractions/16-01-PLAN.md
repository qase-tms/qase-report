---
phase: 16-microinteractions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/usePrefersReducedMotion.ts
  - src/components/Dashboard/index.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard content fades in smoothly when data loads (not instant pop-in)"
    - "Animations are disabled when user has prefers-reduced-motion enabled"
    - "Hook detects OS motion preference and reacts to changes"
  artifacts:
    - path: "src/hooks/usePrefersReducedMotion.ts"
      provides: "Accessibility hook for motion preference detection"
      exports: ["usePrefersReducedMotion"]
    - path: "src/components/Dashboard/index.tsx"
      provides: "Dashboard with fade-in animation"
      contains: "Fade"
  key_links:
    - from: "src/components/Dashboard/index.tsx"
      to: "src/hooks/usePrefersReducedMotion.ts"
      via: "hook import and usage"
      pattern: "usePrefersReducedMotion"
    - from: "src/components/Dashboard/index.tsx"
      to: "@mui/material"
      via: "Fade component"
      pattern: "Fade.*in=.*timeout="
---

<objective>
Create accessibility foundation and implement dashboard fade-in animation.

Purpose: Users see smooth visual feedback when dashboard data loads, with full accessibility support for motion-sensitive users (WCAG 2.1 compliant).

Output: usePrefersReducedMotion hook, Dashboard with Fade wrapper
</objective>

<execution_context>
@/Users/gda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-microinteractions/16-RESEARCH.md
@src/components/Dashboard/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePrefersReducedMotion hook</name>
  <files>src/hooks/usePrefersReducedMotion.ts</files>
  <action>
Create new file `src/hooks/usePrefersReducedMotion.ts` with custom hook:

1. Create `src/hooks/` directory if it doesn't exist
2. Implement hook using `window.matchMedia('(prefers-reduced-motion: no-preference)')`
3. Default to `true` (reduced motion) for SSR safety - safer default
4. Add event listener for `change` event to react to OS setting changes
5. Return boolean: `true` when user prefers reduced motion, `false` otherwise
6. Clean up event listener on unmount

Pattern from research (Josh Comeau approach):
```typescript
const QUERY = '(prefers-reduced-motion: no-preference)'

export function usePrefersReducedMotion() {
  const [prefersReducedMotion, setPrefersReducedMotion] = useState(true)

  useEffect(() => {
    const mediaQueryList = window.matchMedia(QUERY)
    setPrefersReducedMotion(!mediaQueryList.matches)

    const listener = (event: MediaQueryListEvent) => {
      setPrefersReducedMotion(!event.matches)
    }

    mediaQueryList.addEventListener('change', listener)
    return () => mediaQueryList.removeEventListener('change', listener)
  }, [])

  return prefersReducedMotion
}
```

Note: Query checks for "no-preference" so we negate the result.
  </action>
  <verify>
File exists at src/hooks/usePrefersReducedMotion.ts with:
- Named export `usePrefersReducedMotion`
- useState and useEffect imports from react
- matchMedia call with correct query string
- Event listener cleanup in useEffect return
  </verify>
  <done>
Hook file exists with correct implementation, can be imported from src/hooks/usePrefersReducedMotion
  </done>
</task>

<task type="auto">
  <name>Task 2: Add fade-in animation to Dashboard</name>
  <files>src/components/Dashboard/index.tsx</files>
  <action>
Update Dashboard component to wrap content in MUI Fade:

1. Import `Fade` from '@mui/material' (add to existing import)
2. Import `usePrefersReducedMotion` from '../../hooks/usePrefersReducedMotion'
3. Call hook at component top: `const prefersReducedMotion = usePrefersReducedMotion()`
4. Wrap BentoGrid in Fade component:
   - `in={!!reportStore.runData}` - triggers when data loads
   - `timeout={prefersReducedMotion ? 0 : 200}` - instant if reduced motion, 200ms otherwise (shorter per research)
5. Fade requires single child - wrap BentoGrid in Box if needed (check if BentoGrid passes ref)

Important: MUI Fade needs DOM element that accepts ref. BentoGrid is a Box, should work directly.

Structure after change:
```tsx
return (
  <Fade
    in={!!reportStore.runData}
    timeout={prefersReducedMotion ? 0 : 200}
  >
    <BentoGrid>
      {/* existing dashboard cards */}
    </BentoGrid>
  </Fade>
)
```

Keep the "Load a report to view dashboard" message outside Fade (it shows when no data).
  </action>
  <verify>
`npm run build` passes without errors.
Dashboard file contains:
- Import of Fade from @mui/material
- Import of usePrefersReducedMotion hook
- Fade wrapper around BentoGrid with in and timeout props
- prefersReducedMotion used in timeout calculation
  </verify>
  <done>
Dashboard content fades in when data loads, animation skipped when reduced motion preferred
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. src/hooks/usePrefersReducedMotion.ts exists and exports hook
3. src/components/Dashboard/index.tsx imports and uses both Fade and usePrefersReducedMotion
4. Fade component has conditional timeout based on motion preference
</verification>

<success_criteria>
- Hook correctly detects OS motion preference
- Dashboard fades in over 200ms when data loads (with motion enabled)
- Dashboard appears instantly when prefers-reduced-motion is enabled
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-microinteractions/16-01-SUMMARY.md`
</output>
